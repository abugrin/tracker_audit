# Инструмент аудита Yandex Tracker

Современный Python CLI инструмент для аудита очередей Yandex Tracker и прав доступа с красивым выводом и возможностью экспорта в Excel.


## Установка

1. **Клонировать или создать директорию проекта**:
   ```bash
   mkdir tracker_audit && cd tracker_audit
   ```

2. **Настроить виртуальное окружение**:
   ```bash
   python3 -m venv venv
   source venv/bin/activate  # В Windows: venv\Scripts\activate
   ```

3. **Установить зависимости**:
   ```bash
   pip install -r requirements.txt
   ```

## Конфигурация

Перед использованием инструмента необходимо настроить учетные данные Yandex Tracker:

1. **Получить OAuth токен**:
   - Посетите https://yandex.ru/support/tracker/ru/concepts/access
   - Создайте новое приложение или используйте существующее
   - Получите ваш OAuth токен

2. **Найти ID организации**:
   - Перейдите в настройки организации Yandex Tracker
   - Найдите ваш ID организации

3. **Настроить инструмент**:
   ```bash
   python main.py configure
   ```

Инструмент проведет вас через процесс настройки и безопасно сохранит ваши учетные данные.

## Использование

### Основные команды

```bash
# Настроить учетные данные (первоначальная настройка)
python main.py configure

# Запустить комплексный аудит
python main.py audit

# Запустить аудит с пользовательским файлом вывода
python main.py audit --output мой_отчет_аудита.xlsx

# Показать информацию об инструменте
python main.py info

# Получить справку
python main.py --help
```

### Расширенное использование

```bash
# Сбросить конфигурацию
python main.py configure --reset

# Запустить аудит без сводки
python main.py audit --no-summary

# Запустить аудит с определенным путем вывода
python main.py audit -o /path/to/reports/audit_$(date +%Y%m%d).xlsx

# Опции области аудита для лучшей производительности
python main.py audit --scope groups        # Быстро: Только группы
python main.py audit --scope users         # Медленно: Только пользователи
python main.py audit --scope both          # Полный: Группы и пользователи (по умолчанию)
```

### Опции области аудита

Инструмент предлагает три варианта области аудита для баланса скорости и полноты:

- **Только группы** (`--scope groups`): Быстрый аудит, проверяющий только права групп
- **Только пользователи** (`--scope users`): Медленный аудит, проверяющий индивидуальные права пользователей
- **Группы и пользователи** (`--scope both`): Полный аудит, проверяющий как группы, так и пользователей (по умолчанию)

⚠️ **Примечание**: Аудит прав пользователей может занять значительно больше времени для крупных организаций из-за ограничений API.

## Вывод

Инструмент генерирует файл Excel с тремя листами:

1. **Сводка**: Обзорная статистика и разбивки
2. **Очереди**: Подробная информация о всех очередях
3. **Права доступа**: Полный аудит доступа с деталями прав

## Структура проекта

```
tracker_audit/
├── main.py           # Основное CLI приложение
├── config.py         # Управление конфигурацией
├── audit.py          # Функциональность аудита
├── export.py         # Функциональность экспорта Excel
├── translations.py   # Поддержка переводов
├── requirements.txt  # Зависимости Python
├── README.md         # Документация (английский)
├── README_RU.md      # Документация (русский)
└── venv/            # Виртуальное окружение (создается при настройке)
```

## Требования

- Python 3.8+
- Доступ к Yandex Tracker с соответствующими правами
- OAuth токен для доступа к API

## Зависимости

- `yandex_tracker_client` - Официальный клиент API Yandex Tracker
- `typer` - Современный фреймворк CLI
- `rich` - Красивое форматирование терминала
- `openpyxl` - Генерация файлов Excel
- `pydantic` - Валидация данных
- `python-dotenv` - Управление переменными окружения

## Безопасность

- OAuth токены хранятся безопасно в `~/.tracker_audit/.env`
- Токены никогда не отображаются полностью в CLI
- Файлы конфигурации создаются с соответствующими правами

## Устранение неполадок

### Распространенные проблемы

1. **Ошибка аутентификации**:
   - Проверьте правильность OAuth токена
   - Проверьте ваш ID организации
   - Убедитесь, что ваш токен имеет необходимые права

2. **Доступ запрещен**:
   - Убедитесь, что ваша учетная запись имеет доступ к просмотру прав очередей
   - Обратитесь к администратору Tracker за необходимыми правами

3. **Очереди не найдены**:
   - Проверьте, что у вас есть доступ к очередям в вашей организации
   - Проверьте правильность ID организации

### Получение помощи

Выполните `python main.py --help` для получения подробной информации о командах или `python main.py info` для обзора инструмента.

## Фильтрация результатов

Инструмент автоматически исключает из результатов:

1. **Роботов**: Служебные учетные записи не отображаются в отчетах
2. **Права только через группы**: Показываются только прямые назначения пользователей и права на основе ролей

Это обеспечивает чистый, действенный аудит, сосредоточенный на:
- **Прямых назначениях пользователей**
- **Правах на основе ролей** (например, Владелец очереди)
- **Явных правилах запрета**
- **Групповых правах** (организационный доступ)

## Лицензия

Этот проект предоставляется как есть для аудита установок Yandex Tracker.
